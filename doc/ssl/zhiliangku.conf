upstream zhiliangku {
    server 127.0.0.1:8001;
}

server {
    listen 80;
    server_name www.zhiliangku.com;
    charset         utf-8;
    client_max_body_size   50M;
    

    location / {
        rewrite ^(.*) https://$server_name$1 permanent;
    }
}

server {
    listen                                  443;
    server_name                             www.zhiliangku.com;
    ssl                                     on;
    ssl_certificate                         /etc/nginx/domain.crt;
    ssl_certificate_key                     /etc/nginx/domain.key;
    ssl_session_timeout                     5m;
    gzip on;

    gzip_disable "msie6";
    gzip_min_length 1k;
    gzip_buffers    4 16k;
    gzip_comp_level 8;
    gzip_types text/plain application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png image/jpg;
    gzip_vary   on;

    location / {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        if ($request_method ~* "(GET|POST)") {
            add_header "Access-Control-Allow-Origin"  '$http_origin';
            add_header "Access-Control-Allow-Credentials"  'true';
        }

    # Preflighted requests
        if ($request_method = OPTIONS ) {
            add_header "Access-Control-Allow-Origin"  '$http_origin';
            add_header "Access-Control-Allow-Methods" "GET, POST, OPTIONS, HEAD";
            add_header "Access-Control-Allow-Credentials"  'true';
            add_header "Access-Control-Allow-Headers" "Authorization, Origin, X-Requested-With, Content-Type, Accept";
            return 200;
        }

        uwsgi_pass zhiliangku;
        include  /usr/local/openresty/nginx/conf/uwsgi_params;
    }

    location /static {
        root /usr/local/openresty/nginx/html/templates;
        expires    1y;
    }

    location /media {
        root /usr/local/zhiliangku;
        expires    1y;
    }

    location /phpmyadmin  {
       return 500;
    }

    location =  /face.html {
        root   html;

    }
     location =  /face2.html {
        root   html;
    }

}
